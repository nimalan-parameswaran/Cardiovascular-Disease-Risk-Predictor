<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coronary Heart Disease Predictor</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        ::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen flex items-center justify-center p-4 sm:p-6">
    <!-- Main container for the application -->
    <div class="w-full max-w-2xl bg-white shadow-xl rounded-2xl p-6 sm:p-8">
        <!-- Application Title -->
        <div class="text-center mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-900 mb-2">Coronary Heart Disease Predictor</h1>
            <p class="text-sm sm:text-base text-gray-500">Enter the patient's data to predict the probability of developing CHD.</p>
        </div>

        <!-- Model Selection Dropdown -->
        <div class="mb-6 flex flex-col items-center">
            <label for="model_name" class="block text-sm font-medium text-gray-700 mb-2">Select Prediction Model</label>
            <select id="model_name" name="model_name"
                class="w-full sm:w-2/3 px-4 py-3 border border-sky-600 rounded-md bg-sky-500 text-white font-semibold shadow-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors">
                <option value="Logistic Regression">Logistic Regression</option>
                <option value="LDA">LDA</option>
                <option value="Ridge">Ridge</option>
                <option value="Decision Tree">Decision Tree</option>
                <option value="Random Forest">Random Forest</option>
                <option value="Gradient Boosting">Gradient Boosting</option>
                <option value="XGBoost">XGBoost</option>
                <option value="LightGBM">LightGBM</option>
                <option value="CatBoost">CatBoost</option>
                <option value="Linear SVM">Linear SVM</option>
                <option value="Kernel SVM (RBF)">Kernel SVM (RBF)</option>
                <option value="Kernel SVM (Poly)">Kernel SVM (Poly)</option>
                <option value="KNN">KNN</option>
                <option value="Gaussian NB">Gaussian NB</option>
                <option value="Bernoulli NB">Bernoulli NB</option>
                <option value="Multinomial NB">Multinomial NB</option>
                <option value="Voting Classifier">Voting Classifier</option>
                <option value="Stacking Classifier">Stacking Classifier</option>
            </select>
        </div>

        <!-- Prediction Form -->
        <form id="prediction-form" class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">

            <!-- Age Input -->
            <div class="col-span-1">
            <label for="age" class="block text-sm font-medium text-gray-700 mb-1">Age</label>
            <input type="number" id="age" name="age" placeholder="e.g., 61"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- Education Input -->
            <div class="col-span-1">
            <label for="education" class="block text-sm font-medium text-gray-700 mb-1">Education Level</label>
            <select id="education" name="education"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
                <option value="" disabled selected>Select Education</option>
                <option value="1">High School or Less</option>
                <option value="2">Some College</option>
                <option value="3">Bachelor's Degree</option>
                <option value="4">Graduate Degree</option>
            </select>
            </div>

            <!-- Sex Input -->
            <div class="col-span-1">
            <label for="sex" class="block text-sm font-medium text-gray-700 mb-1">Sex</label>
            <select id="sex" name="sex"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
                <option value="" disabled selected>Select Sex</option>
                <option value="0">Female</option>
                <option value="1">Male</option>
            </select>
            </div>

            <!-- Smoking Status Input -->
            <div class="col-span-1">
            <label for="is_smoking" class="block text-sm font-medium text-gray-700 mb-1">Smoking Status</label>
            <select id="is_smoking" name="is_smoking"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
                <option value="" disabled selected>Select Status</option>
                <option value="0">Non-Smoker</option>
                <option value="1">Smoker</option>
            </select>
            </div>

            <!-- Cigarettes Per Day Input -->
            <div class="col-span-1">
            <label for="cigsPerDay" class="block text-sm font-medium text-gray-700 mb-1">Cigarettes Per Day</label>
            <input type="number" id="cigsPerDay" name="cigsPerDay" placeholder="e.g., 3"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- BPMeds Input -->
            <div class="col-span-1">
            <label for="BPMeds" class="block text-sm font-medium text-gray-700 mb-1">On BP Medication?</label>
            <select id="BPMeds" name="BPMeds"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
                <option value="" disabled selected>Select an option</option>
                <option value="0">No</option>
                <option value="1">Yes</option>
            </select>
            </div>

            <!-- Prevalent Stroke Input -->
            <div class="col-span-1">
            <label for="prevalentStroke" class="block text-sm font-medium text-gray-700 mb-1">Prevalent Stroke?</label>
            <select id="prevalentStroke" name="prevalentStroke"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
                <option value="" disabled selected>Select an option</option>
                <option value="0">No</option>
                <option value="1">Yes</option>
            </select>
            </div>

            <!-- Prevalent Hypertension Input -->
            <div class="col-span-1">
            <label for="prevalentHyp" class="block text-sm font-medium text-gray-700 mb-1">Prevalent Hypertension?</label>
            <select id="prevalentHyp" name="prevalentHyp"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
                <option value="" disabled selected>Select an option</option>
                <option value="0">No</option>
                <option value="1">Yes</option>
            </select>
            </div>

            <!-- Diabetes Input -->
            <div class="col-span-1">
            <label for="diabetes" class="block text-sm font-medium text-gray-700 mb-1">Diabetes?</label>
            <select id="diabetes" name="diabetes"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
                <option value="" disabled selected>Select an option</option>
                <option value="0">No</option>
                <option value="1">Yes</option>
            </select>
            </div>

            <!-- Total Cholesterol Input -->
            <div class="col-span-1">
            <label for="totChol" class="block text-sm font-medium text-gray-700 mb-1">Total Cholesterol (mg/dL)</label>
            <input type="number" step="0.1" id="totChol" name="totChol" placeholder="e.g., 233"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- Systolic BP Input -->
            <div class="col-span-1">
            <label for="sysBP" class="block text-sm font-medium text-gray-700 mb-1">Systolic BP (mm Hg)</label>
            <input type="number" step="0.1" id="sysBP" name="sysBP" placeholder="e.g., 182"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- Diastolic BP Input -->
            <div class="col-span-1">
            <label for="diaBP" class="block text-sm font-medium text-gray-700 mb-1">Diastolic BP (mm Hg)</label>
            <input type="number" step="0.1" id="diaBP" name="diaBP" placeholder="e.g., 90"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- BMI Input -->
            <div class="col-span-1">
            <label for="BMI" class="block text-sm font-medium text-gray-700 mb-1">BMI</label>
            <input type="number" step="0.1" id="BMI" name="BMI" placeholder="e.g., 32.8"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- Heart Rate Input -->
            <div class="col-span-1">
            <label for="heartRate" class="block text-sm font-medium text-gray-700 mb-1">Heart Rate (bpm)</label>
            <input type="number" step="0.1" id="heartRate" name="heartRate" placeholder="e.g., 80"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- Glucose Input -->
            <div class="col-span-1">
            <label for="glucose" class="block text-sm font-medium text-gray-700 mb-1">Glucose (mg/dL)</label>
            <input type="number" step="0.1" id="glucose" name="glucose" placeholder="e.g., 65"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- Exercise Induced Angina Input -->
            <div class="col-span-1">
            <label for="exng" class="block text-sm font-medium text-gray-700 mb-1">Exercise Induced Angina?</label>
            <select id="exng" name="exng"
                class="w-full px-4 py-2 border border-gray-300 rounded-md bg-white focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
                <option value="" disabled selected>Select an option</option>
                <option value="0">No</option>
                <option value="1">Yes</option>
            </select>
            </div>

            <!-- Number of Major Vessels Input -->
            <div class="col-span-1">
            <label for="caa" class="block text-sm font-medium text-gray-700 mb-1">Number of Major Vessels (caa)</label>
            <input type="number" id="caa" name="caa" min="0" max="4" placeholder="e.g., 2"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- Triglyceride Input -->
            <div class="col-span-1">
            <label for="Triglyceride" class="block text-sm font-medium text-gray-700 mb-1">Triglyceride (mg/dL)</label>
            <input type="number" step="0.1" id="Triglyceride" name="Triglyceride" placeholder="e.g., 150"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- HDL Cholesterol Input -->
            <div class="col-span-1">
            <label for="hdl_cholestrol" class="block text-sm font-medium text-gray-700 mb-1">HDL Cholesterol (mg/dL)</label>
            <input type="number" step="0.1" id="hdl_cholestrol" name="hdl_cholestrol" placeholder="e.g., 26"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- LDL Cholesterol Input -->
            <div class="col-span-1">
            <label for="ldl_cholestrol" class="block text-sm font-medium text-gray-700 mb-1">LDL Cholesterol (mg/dL)</label>
            <input type="number" step="0.1" id="ldl_cholestrol" name="ldl_cholestrol" placeholder="e.g., 100"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>

            <!-- CPK-MB Percentage Input -->
            <div class="col-span-1">
            <label for="CPK_MB_Percentage" class="block text-sm font-medium text-gray-700 mb-1">CPK-MB Percentage (%)</label>
            <input type="number" step="0.1" id="CPK_MB_Percentage" name="CPK_MB_Percentage" placeholder="e.g., 5.2"
                class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-sky-500 transition-colors"
                required>
            </div>
            
            <!-- Submit Button -->
            <div class="col-span-1 sm:col-span-2 mt-4">
                <button type="submit"
                    class="w-full py-3 px-6 bg-sky-600 text-white font-semibold rounded-md shadow-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-2 transition-all duration-300">
                    Predict
                </button>
            </div>
        </form>

        <!-- Prediction Result Display -->
        <div id="result-container" class="mt-8 pt-6 border-t border-gray-200">
            <div id="loading" class="hidden text-center text-sky-600 font-medium">
                <svg class="animate-spin h-5 w-5 text-sky-600 inline-block mr-2" xmlns="http://www.w3.org/2000/svg"
                    fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z">
                    </path>
                </svg>
                <span class="text-gray-500">Predicting...</span>
            </div>
            <div id="error" class="hidden text-center text-red-500 font-medium">
                An error occurred. Please check your inputs and try again.
            </div>
            <div id="result" class="hidden text-center">
                <!-- Result will be displayed here -->
            </div>
        </div>

    </div>

    <!-- Gradio Client and Main Script -->
    <script type="module">
        import { Client } from "https://cdn.jsdelivr.net/npm/@gradio/client/dist/index.min.js";

        const form = document.getElementById('prediction-form');
        const modelSelect = document.getElementById('model_name');
        const loadingDiv = document.getElementById('loading');
        const errorDiv = document.getElementById('error');
        const resultDiv = document.getElementById('result');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            // Clear previous results and show loading indicator
            resultDiv.innerHTML = '';
            resultDiv.classList.add('hidden');
            errorDiv.classList.add('hidden');
            loadingDiv.classList.remove('hidden');

            try {
                // Connect to the Gradio client
                const client = await Client.connect("nimalan/Coronary-Heart-Disease-Prediction");

                // Get form data and prepare for prediction
                const formData = new FormData(form);
                const predictionData = {
                    model_name: modelSelect.get('model_name'),
                    age: parseFloat(formData.get('age')),
                    sex: formData.get('sex'),
                    is_smoking: formData.get('is_smoking'),
                    cigsPerDay: parseFloat(formData.get('cigsPerDay')),
                    BPMeds: formData.get('BPMeds'),
                    prevalentStroke: formData.get('prevalentStroke'),
                    prevalentHyp: formData.get('prevalentHyp'),
                    sysBP: parseFloat(formData.get('sysBP')),
                    BMI: parseFloat(formData.get('BMI')),
                    glucose: parseFloat(formData.get('glucose')),
                    hdl_cholestrol: parseFloat(formData.get('hdl_cholestrol'))
                };

                // Log the payload for debugging
                console.log("Sending data to Gradio API:", predictionData);

                // Perform the prediction
                const result = await client.predict("/predict", predictionData);

                // Log the full result from the API for debugging
                console.log("Received result from Gradio API:", result);

                // Handle the successful result
                if (result.data && Array.isArray(result.data) && result.data.length > 0) {
                    const probability = parseFloat(result.data[0]);
                    const percentage = (probability * 100).toFixed(2);
                    
                    let message = '';
                    let messageClass = '';

                    if (probability > 0.5) {
                        message = 'High probability of developing coronary heart disease.';
                        messageClass = 'text-red-500';
                    } else if (probability > 0.2) {
                        message = 'Moderate probability of developing coronary heart disease.';
                        messageClass = 'text-yellow-500';
                    } else {
                        message = 'Low probability of developing coronary heart disease.';
                        messageClass = 'text-green-500';
                    }

                    resultDiv.innerHTML = `
                        <p class="text-base sm:text-lg font-bold text-gray-800">Prediction Result:</p>
                        <p class="text-3xl sm:text-4xl font-extrabold ${messageClass} mt-2">${percentage}%</p>
                        <p class="text-sm sm:text-base text-gray-600 mt-2">${message}</p>
                    `;
                    resultDiv.classList.remove('hidden');
                } else {
                    console.error("API response was not in the expected format.", result);
                    errorDiv.classList.remove('hidden');
                }

            } catch (error) {
                console.error("Prediction failed:", error);
                errorDiv.classList.remove('hidden');
            } finally {
                // Hide loading indicator
                loadingDiv.classList.add('hidden');
            }
        });
    </script>
</body>

</html>
